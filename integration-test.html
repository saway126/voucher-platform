<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© í…ŒìŠ¤íŠ¸ - ë°”ìš°ì²˜ í”Œë«í¼</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2E7D32;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #2E7D32;
            margin-top: 0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .test-result.pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-result.loading {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #2E7D32;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1B5E20;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .api-response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-indicator.online {
            background-color: #28a745;
        }
        .status-indicator.offline {
            background-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª í†µí•© í…ŒìŠ¤íŠ¸ - ë°”ìš°ì²˜ í”Œë«í¼</h1>
        
        <div class="test-section">
            <h3>ì„œë²„ ìƒíƒœ í™•ì¸</h3>
            <div id="serverStatus">
                <span class="status-indicator offline"></span>
                <span>ë°±ì—”ë“œ ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...</span>
            </div>
            <button onclick="checkServerStatus()">ì„œë²„ ìƒíƒœ í™•ì¸</button>
        </div>

        <div class="test-section">
            <h3>ì¸ì¦ API í…ŒìŠ¤íŠ¸</h3>
            <div id="authTestResults"></div>
            <button onclick="testAuthAPI()">ì¸ì¦ API í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="test-section">
            <h3>í”„ë¡œê·¸ë¨ API í…ŒìŠ¤íŠ¸</h3>
            <div id="programTestResults"></div>
            <button onclick="testProgramAPI()">í”„ë¡œê·¸ë¨ API í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="test-section">
            <h3>ì‹ ì²­ì„œ API í…ŒìŠ¤íŠ¸</h3>
            <div id="applicationTestResults"></div>
            <button onclick="testApplicationAPI()">ì‹ ì²­ì„œ API í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="test-section">
            <h3>ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</h3>
            <div id="integrationTestResults"></div>
            <button onclick="runIntegrationTest()">ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        </div>
    </div>

    <script src="api-client.js"></script>
    <script>
        const apiClient = new ApiClient();
        
        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            const statusElement = document.getElementById('serverStatus');
            const indicator = statusElement.querySelector('.status-indicator');
            const text = statusElement.querySelector('span:last-child');
            
            try {
                const response = await fetch('http://localhost:3000/api/programs');
                if (response.ok) {
                    indicator.className = 'status-indicator online';
                    text.textContent = 'ë°±ì—”ë“œ ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.';
                } else {
                    indicator.className = 'status-indicator offline';
                    text.textContent = `ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`;
                }
            } catch (error) {
                indicator.className = 'status-indicator offline';
                text.textContent = `ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`;
            }
        }

        // ì¸ì¦ API í…ŒìŠ¤íŠ¸
        async function testAuthAPI() {
            const resultsElement = document.getElementById('authTestResults');
            resultsElement.innerHTML = '<div class="test-result loading">ì¸ì¦ API í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                // íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
                const registerData = {
                    email: 'test@integration.com',
                    password: 'testpassword123',
                    name: 'í†µí•©í…ŒìŠ¤íŠ¸ì‚¬ìš©ì',
                    type: 'individual',
                    phone: '010-1234-5678'
                };
                
                const registerResponse = await apiClient.register(registerData);
                resultsElement.innerHTML += `<div class="test-result pass">âœ… íšŒì›ê°€ì… API í…ŒìŠ¤íŠ¸ í†µê³¼</div>`;
                
                // ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
                const loginData = {
                    email: 'test@integration.com',
                    password: 'testpassword123'
                };
                
                const loginResponse = await apiClient.login(loginData);
                resultsElement.innerHTML += `<div class="test-result pass">âœ… ë¡œê·¸ì¸ API í…ŒìŠ¤íŠ¸ í†µê³¼</div>`;
                
                // í† í° ê²€ì¦ í…ŒìŠ¤íŠ¸
                const verifyResponse = await apiClient.verifyToken();
                resultsElement.innerHTML += `<div class="test-result pass">âœ… í† í° ê²€ì¦ API í…ŒìŠ¤íŠ¸ í†µê³¼</div>`;
                
            } catch (error) {
                resultsElement.innerHTML += `<div class="test-result fail">âŒ ì¸ì¦ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // í”„ë¡œê·¸ë¨ API í…ŒìŠ¤íŠ¸
        async function testProgramAPI() {
            const resultsElement = document.getElementById('programTestResults');
            resultsElement.innerHTML = '<div class="test-result loading">í”„ë¡œê·¸ë¨ API í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                const programs = await apiClient.getPrograms();
                resultsElement.innerHTML += `<div class="test-result pass">âœ… í”„ë¡œê·¸ë¨ ëª©ë¡ ì¡°íšŒ ì„±ê³µ (${programs.length}ê°œ)</div>`;
                
                if (programs.length > 0) {
                    const program = programs[0];
                    resultsElement.innerHTML += `<div class="api-response">${JSON.stringify(program, null, 2)}</div>`;
                }
                
            } catch (error) {
                resultsElement.innerHTML += `<div class="test-result fail">âŒ í”„ë¡œê·¸ë¨ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ì‹ ì²­ì„œ API í…ŒìŠ¤íŠ¸
        async function testApplicationAPI() {
            const resultsElement = document.getElementById('applicationTestResults');
            resultsElement.innerHTML = '<div class="test-result loading">ì‹ ì²­ì„œ API í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                const applications = await apiClient.getApplications();
                resultsElement.innerHTML += `<div class="test-result pass">âœ… ì‹ ì²­ì„œ ëª©ë¡ ì¡°íšŒ ì„±ê³µ (${applications.length}ê°œ)</div>`;
                
                // ì‹ ì²­ì„œ ìƒì„± í…ŒìŠ¤íŠ¸
                const applicationData = {
                    programId: 1,
                    applicantId: 1,
                    formData: {
                        name: 'í…ŒìŠ¤íŠ¸ ì‹ ì²­ì',
                        email: 'test@example.com',
                        phone: '010-1234-5678',
                        purpose: 'í†µí•© í…ŒìŠ¤íŠ¸ìš© ì‹ ì²­ì„œ'
                    }
                };
                
                const newApplication = await apiClient.createApplication(applicationData);
                resultsElement.innerHTML += `<div class="test-result pass">âœ… ì‹ ì²­ì„œ ìƒì„± ì„±ê³µ</div>`;
                
            } catch (error) {
                resultsElement.innerHTML += `<div class="test-result fail">âŒ ì‹ ì²­ì„œ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸
        async function runIntegrationTest() {
            const resultsElement = document.getElementById('integrationTestResults');
            resultsElement.innerHTML = '<div class="test-result loading">ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';
            
            let passedTests = 0;
            let totalTests = 0;
            
            // ì„œë²„ ìƒíƒœ í™•ì¸
            totalTests++;
            try {
                await checkServerStatus();
                const statusElement = document.getElementById('serverStatus');
                const indicator = statusElement.querySelector('.status-indicator');
                if (indicator.classList.contains('online')) {
                    passedTests++;
                    resultsElement.innerHTML += `<div class="test-result pass">âœ… ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ í†µê³¼</div>`;
                } else {
                    resultsElement.innerHTML += `<div class="test-result fail">âŒ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</div>`;
                }
            } catch (error) {
                resultsElement.innerHTML += `<div class="test-result fail">âŒ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
            
            // API í…ŒìŠ¤íŠ¸ë“¤
            const testFunctions = [
                { name: 'ì¸ì¦ API', func: testAuthAPI },
                { name: 'í”„ë¡œê·¸ë¨ API', func: testProgramAPI },
                { name: 'ì‹ ì²­ì„œ API', func: testApplicationAPI }
            ];
            
            for (const test of testFunctions) {
                totalTests++;
                try {
                    await test.func();
                    passedTests++;
                    resultsElement.innerHTML += `<div class="test-result pass">âœ… ${test.name} í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼</div>`;
                } catch (error) {
                    resultsElement.innerHTML += `<div class="test-result fail">âŒ ${test.name} í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
                }
            }
            
            // ìµœì¢… ê²°ê³¼
            const successRate = ((passedTests / totalTests) * 100).toFixed(1);
            resultsElement.innerHTML += `<div class="test-result ${passedTests === totalTests ? 'pass' : 'fail'}">
                ğŸ“Š í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passedTests}/${totalTests} í†µê³¼ (${successRate}%)
            </div>`;
            
            if (passedTests === totalTests) {
                resultsElement.innerHTML += `<div class="test-result pass">ğŸ‰ ëª¨ë“  í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤!</div>`;
            } else {
                resultsElement.innerHTML += `<div class="test-result fail">âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìœ„ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</div>`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            checkServerStatus();
        });
    </script>
</body>
</html>
